{layout name="layout" /}
{php}$title = "首页"{/php}
{include file="public:header" }
<div id="container">
    {include file="public:menu" }
    <div id="content">
        <div class="container">
            {include file="public:nav" }
            <div class="page-header"></div>
            <div class="row" >
                <div class="col-md-12">
                    <div class="widget box" >
                        <div class="widget-header">
                            <h4>功能</h4>
                        </div>
                        <div class="widget-content">
                            <a class="btn btn-info" onclick="operate('create')" >创建应用</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="widget box">
                        <div class="widget-header">
                            <h4>
                                <i class="icon-reorder">
                                </i>
                                应用列表
                            </h4>
                            <div class="toolbar no-padding">
                                <div class="btn-group">
                                    <span class="btn btn-xs widget-collapse"><i class="icon-angle-down"></i></span>
                                </div>
                            </div>
                        </div>
                        <div class="widget-content no-padding">
                            <table class="table table-striped table-bordered table-hover table-checkable table-colvis datatable">
                                <thead>
                                <tr>
                                    <th>应用名</th>
                                    <th>平台</th>
                                    <th>appkey</th>
                                    <th>创建时间</th>
                                    <th>上线时间</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody>
                                {foreach name='list' item='vo'}
                                <tr>
                                    <td>{$vo['title']}({$vo['version']})</td>
                                    <td>{$vo['platform']}</td>
                                    <td>{$vo['appkey']}</td>
                                    <td>{$vo['create_time']}</td>
                                    <td>{$vo['up_time']}</td>
                                    <td>
                                        {php}
                                        switch($vo['app_status']){
                                        case 0:$s = "default";$t="测试阶段";break;
                                        case 1:$s = "success";$t="已上线";break;
                                        case 2:$s = "warning";$t="已下线";break;
                                        }
                                        {/php}
                                        <span class="label label-{$s}">{$t}</span>
                                    </td>
                                    <td class="align-left">
                                        <ul class="table-controls">
                                            {php}$id = $vo['id'];{/php}
                                            {php}if($vo['app_status']==0){{/php}
                                            <li><a href="{:url('user/manage/edit')}?id={$id}" class="bs-tooltip"  title="编辑"><i class="icon-pencil"></i></a></li>
                                            <li><a href="javascript:void(0)"  onclick="upToOnline('{$id}')" class="bs-tooltip" title="上线" ><i class="icon-arrow-up"></i></a></li>
                                            {php}}else if($vo['app_status']==1){{/php}
                                            <li><a href="javascript:void(0)"  onclick="abandon('{$id}')" class="bs-tooltip" title="下线" ><i class="icon-off"></i></a></li>
                                            {php}}else{{/php}
                                            <li><a href="javascript:void(0)"  onclick="upToOnline('{$id}')" class="bs-tooltip" title="重新上线" ><i class="icon-reply"></i></a></li>
                                            {php}}{/php}
                                        </ul>
                                    </td>
                                </tr>
                                {/foreach}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
<script type="application/javascript">
    function operate(type,id) {
        var url,width,height,title;
        if(type == 'create'){
            url = "{:url('application/index/create')}";
            width = '500px';
            height = '480px';
            title = "创建应用";
        }else if(type == 'edit'){
            url = "{:url('application/index/edit')}?id="+id;
            width = '500px';
            height = '750px';
            title = "编辑应用";
        }
        layer.open({
            type: 2,
            title: title,
            shadeClose: true,
            shade: 0.8,
            area: [width, height],
            content: url
        });
    }
    function upToOnline(id) {
        var url = "{:url('application/up/upToOnline')}";
        var obj = {id:id};
        postSomething(url,obj);
    }
    function abandon(id) {
        var url = "{:url('application/up/abandon')}";
        var obj = {id:id};
        postSomething(url,obj);
    }
</script>