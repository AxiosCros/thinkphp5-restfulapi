<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <title>socket测试</title>
    <script type="application/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script type="text/javascript">
        var ws;
        var isClose;

        startSocket();
        function startSocket() {
            isClose = 0;
            ws = new WebSocket("wss://admin.pianobridge.pub:2346")
            // 打开一个 web socket
            ws.onopen = function()
            {
                // Web Socket 已连接上，使用 send() 方法发送数据
                send();
            };

            ws.onmessage = function (evt)
            {
                var received_msg = evt.data;
                input("接受数据"+received_msg);
            };

            ws.onclose = function()
            {
                isClose = 1;
                input("连接关闭")
            };
        }

        function send(d) {
            var data = $("#data").val();
            if(d !==undefined){
                ws.send(d);
            }else{
                ws.send(data);
            }
            input("发送数据" + data)
        }

        function closeSocket() {
            input("发送关闭连接请求");
            ws.close();
        }

        function input(str) {
            $("#receive").append(str + "\n");
        }

        /*var timer = setInterval(function (e) {
            // var str = Math.random().toString(36).substr(2);
            if(!isClose){
                send();
            }
        },15000);*/
    </script>

</head>
<body>

<div id="sse">
    <button onclick="send()" style="display: block">发送信息</button>
    <button onclick="closeSocket()" style="display: block">关闭连接</button>
    <button onclick="startSocket()" style="display: block">启动连接</button>
    <br>
    <label for="data">消息内容(json格式)</label><br>
    <textarea id="data" style="width: 400px;height: 400px;">{"s":"index/index/index","params":{"a":"b"}}</textarea>
    <textarea id="receive" style="width: 800px;height: 400px;"></textarea>
</div>

</body>
</html>